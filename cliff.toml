# git-cliff ~ configuration file
# https://git-cliff.org/docs/configuration

[changelog]
# Chemin du fichier changelog Ã  la racine du projet
output = "CHANGELOG.md"

# En-tÃªte du changelog
header = """
# ğŸ“‹ Changelog

Tous les changements notables de ce projet sont documentÃ©s dans ce fichier.

Le format est basÃ© sur [Keep a Changelog](https://keepachangelog.com/fr/1.0.0/),
et ce projet adhÃ¨re au [Semantic Versioning](https://semver.org/lang/fr/).

"""

# Template du corps du changelog
body = """
{% if version %}\
    ## [{{ version | trim_start_matches(pat="v") }}] - {{ timestamp | date(format="%Y-%m-%d") }}
{% else %}\
    ## [Unreleased]
{% endif %}\
{% for group, commits in commits | group_by(attribute="group") %}
    ### {{ group | striptags | trim | upper_first }}
    {% for commit in commits
    | filter(attribute="scope")
    | sort(attribute="scope") %}
        - **{{commit.scope}}:** {{ commit.message | upper_first }}{% if commit.breaking %} âš ï¸ **BREAKING CHANGE**{% endif %} ([{{ commit.id | truncate(length=7, end="") }}]({{ commit.id }}))
    {%- endfor -%}
    {% for commit in commits %}
        {%- if commit.scope -%}
        {% else -%}
            - {{ commit.message | upper_first }}{% if commit.breaking %} âš ï¸ **BREAKING CHANGE**{% endif %} ([{{ commit.id | truncate(length=7, end="") }}]({{ commit.id }}))
        {% endif -%}
    {% endfor -%}
{% endfor %}\n
"""

# Supprime les espaces au dÃ©but et Ã  la fin
trim = true

# Pied de page du changelog
footer = """
<!-- GÃ©nÃ©rÃ© automatiquement par git-cliff -->
"""

[git]
# Parse selon la spec conventional commits
conventional_commits = true
# Filtre les commits non-conventionnels
filter_unconventional = true
# Traite chaque ligne comme un commit individuel
split_commits = false
# Chemin du workspace (pour gÃ©nÃ©rer un changelog global, pas par crate)
commit_path = "."

# PrÃ©processeurs pour les messages de commit
commit_preprocessors = [
  # Supprime les numÃ©ros d'issues/PR du scope
  { pattern = '\((\w+)\s?#\d+\)', replace = "($1)" },
  # Nettoyage des espaces
  { pattern = '  +', replace = " " },
]

# Parsers pour grouper les commits
commit_parsers = [
  { message = "^feat", group = "âœ¨ Nouvelles fonctionnalitÃ©s" },
  { message = "^fix", group = "ğŸ› Corrections de bugs" },
  { message = "^doc", group = "ğŸ“š Documentation" },
  { message = "^perf", group = "âš¡ Performance" },
  { message = "^refactor", group = "â™»ï¸ Refactoring" },
  { message = "^style", group = "ğŸ¨ Style" },
  { message = "^test", group = "ğŸ§ª Tests" },
  { message = "^build", group = "ğŸ—ï¸ Build" },
  { message = "^ci", group = "ğŸ‘· CI/CD" },
  { message = "^chore\\(release\\): prepare for", skip = true },
  { message = "^chore\\(deps\\)", skip = true },
  { message = "^chore\\(pr\\)", skip = true },
  { message = "^chore\\(pull\\)", skip = true },
  { message = "^chore", group = "ğŸ”§ Maintenance" },
  { body = ".*security", group = "ğŸ”’ SÃ©curitÃ©" },
  { message = "^revert", group = "âª Reverts" },
]

# ProtÃ¨ge les breaking changes
protect_breaking_commits = true
# Filtre les commits non-matchÃ©s
filter_commits = true
# Pattern pour les tags git (supporte semver complet: v3.0.0, v3.0.0-alpha.0, etc.)
tag_pattern = "v[0-9]+\\.[0-9]+\\.[0-9]+.*"
# N'ignore aucun tag (inclut alpha, beta, rc, etc.)
skip_tags = ""
ignore_tags = ""
# Tri topologique
topo_order = false
# Tri des commits par date
sort_commits = "newest"
